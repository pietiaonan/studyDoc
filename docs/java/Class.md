

##  基本信息

Java语言中的各种变量、关键字和运算符的语义最终都是由多条字节码命令组合而成的，因此字节码命令所能提供的语义描述能力肯定会比Java语言本身更强大，这便为其他语言实现一些有别于Java的语言特性提供了基础，而且这也正是在类加载时要进行安全验证的原因。


- 字节码

字节码是一种包含执行程序，由数据对组成的二进制文件，是一种中间码。一般来说，一字节占用8位，即包含八位的二进制。

文章所指的.Class文件为字节码文件，每字节用16进制表示，数值范围 00 ~ FF (0 ~ 255).

- 无符号数基本类型

无符号数可以用来描述数字、索引引用、数值量或按照 UTF-8 编码构成字符串。u1、u2、u4、u8分别代表 1个字节、2个字节、4个字节和8个字节的无符号数。

- 字面量

字面量是一种固定值的表示法，本身没有含义，需要场景来为它赋予含义，如何理解？比如 007 没有含义，但是用来表示詹姆斯·邦德，你就知道007代表一个很厉害的特工。在程序中，int x = 10、String s = "10" 让字面量 10 具有了不同的意义。

- 全限定名

将一个类的全限定名是将类全名的.全部替换为/，如java.lang.String替换为java/lang/String

- 描述符

描述符用来描述字段的数据类型、方法的参数类表和返回值，每种符号对应不同数据类型
![泛型](..\img\java\msf.jfif)



##  结构

class 由10个部分组成,整个Class文件本质上就是一张表，它由如下所示的数据项构成。

![泛型](..\img\java\c2.jfif)

![泛型](..\img\java\c1.jfif)

Class文件是一组以8位字节为基础单位的二进制流,根据Java虚拟机规范的规定，
class结构中只有两种数据类型：无符号数和表。
无符号数属于基本数据类型，以u1、u2、u4、u8来分别代表1、2、4、8个字节的无符号数。
表是由多个无符号数或其他表作为数据项构成的符合数据类型，所有的表都习惯性地以“_info”结尾。

文件为字节码文件，每字节用16进制表示，一个是4bit，两个是8bit也就是一个byte，数值范围 00 ~ FF (0 ~ 255)，开头是4个byte是： cafe babe
例如：

cafe babe 0000 0034 0028 0a00 0600 1a09
....


### 1、无符号数
- 无符号数属于基本的数据类型，以u1、u2、u4、u8来分别代表1个字节，2个字节，4个字节，8个字节的无符号数。
- 无符号数可用来描述数字、索引引用、数量值或者按照UTF-8编码构成字符串值。

### 2、表
由多个无符号数或者其他表作为数据项构成的复合数据类型，以“_info”结尾。表用于描述有层次关系的复合结构的数据，整个Class文件本质上就是一张表。由以下数据项构成

![泛型](..\img\java\u.jfif)

#### 2.1、魔数 magic 
每个Class文件的头4个字节成为魔数（Magic Number），它的唯一作用是确定这个文件是否为一个能被虚拟机接受的Class文件，为0xCAFEBABE


#### 2.2、 版本号  major_version.minor_version


紧接着魔数的这个字节存储的是Class文件的版本号：

第5和第6个字节是次版本号（Minor Version）
第7和第8个字节是主版本号（Major Version）
Java的版本号是从45开始的
52--》1.8

#### 2.3 、常量池  constant_pool
- 占用Class文件空间最大的数据项目之一，同时也是Class文件中第一个出现的表类型数据项目；
- 常量池中主要存放两大类常量：字面量（Literal）和符号引用（Symbolic Reference）


	1) 字面量比较接近Java语言的常量概念，如文本字符串、声明为final的常量值等；
	
	2) 符号引用，包括了三类常量：类和接口的全限定名、字段的名称和描述符、方法的名称和描述符。

个人理解:通过jclasslib查看 常量池中，带里连接的都是符号引号，可以指向其他引用或者字面量
字面量是不去引用其他，有值，有大小

![泛型](..\img\java\y2.png)
![泛型](..\img\java\y1.png)


- 在常量池的入口处存在一项u2类型的数据，常量池计数器，constant_pool_count的值等于constant_pool表中的成员数加1。constant_pool表的索引值只有在大于0且小于constant_pool_count时才会被认为是有效的（值为0的constant_pool索引是无效的，但其他用到常量池的数据结构可以使用索引0来表示“不引用任何一个常量池项”的意思），对于long和double类型有例外情况。

注：在Java字节码中，所有boolean、byte、char、short类型都是用int类型存放，因而在常量池中没有和它们对应的项。

#### 2.4、 access_flags
指定类或接口的访问权限。

#### 2.5、 this_class
####  2.6 、super_class
#### 2.7 、interfaces
####  2.8 、fields
####  2.9、 methods


- 关于方法
非静态方法，第一个参数会把this传入，所以可以用this

构造方法也会传入this

非静态方法不传入this，所以非静态方法不能用this

字节码文件方法的第一个会把构造器方法加上

有main除外的静态方法，会加上clinit方法

![泛型](..\img\java\m2.png)
![泛型](..\img\java\m1.png)
![泛型](..\img\java\m4.png)

#### 2.10 、attributes



## 相关工具
- javap  
 -v 详细信息

 -c 汇编语言

- jclasslib bytecode 
![泛型](..\img\java\bc.png)


- 

## 参考

http://www.blogjava.net/DLevin/archive/2011/09/05/358033.html

https://www.toutiao.com/a6764707235563045390/

https://www.toutiao.com/a6680452498626445827/

https://www.toutiao.com/a6651014484104053256/
